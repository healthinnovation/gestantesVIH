names(data_read)
variables <-  c("AGE_MOTHER","EDUCATION_LEVEL" )
data_read[variables]
head(data_read[variables],10)
names(data_read)
variables <-  c("AGE_MOTHER","EDUCATION_LEVEL","CURRENT_MARITAL_STATUS","KNOW_STD","KNOW_STD_SYMPTOM","V001","V005",
"V022","IDX94","B2","filtro" )
data <- data_read[variables]
length(CASEID)
length(unique(V001))
nrow(data)
df<-
data %>%
group_by(year) %>%
nest() %>%
mutate(
datasvy = map(.x = data,
.f = ~svydesign(id =~ V001, strata =~ V022, weights=~V005, data=.x))
)
variables <-  c("year","AGE_MOTHER","EDUCATION_LEVEL","CURRENT_MARITAL_STATUS","KNOW_STD","KNOW_STD_SYMPTOM","V001","V005",
"V022","IDX94","B2","filtro" )
data <- data_read[variables]
nrow(data)
df<-
data %>%
group_by(year) %>%
nest() %>%
mutate(
datasvy = map(.x = data,
.f = ~svydesign(id =~ V001, strata =~ V022, weights=~V005, data=.x))
)
df <- data_read[variables]
datav <- data_read[variables]
nrow(datav)
df<-
datav %>%
group_by(year) %>%
nest() %>%
mutate(
datasvy = map(.x = data,
.f = ~svydesign(id =~ V001, strata =~ V022, weights=~V005, data=.x))
)
#install.packages("tmap")
library(tmap)
install.packages("tmap")
df<-
datav %>%
group_by(year) %>%
nest() %>%
mutate(
datasvy = map(.x = data,
.f = ~svydesign(id =~ V001, strata =~ V022, weights=~V005, data=.x))
)
#install.packages("tmap")
library(tmap)
library(survey)
df<-
datav %>%
group_by(year) %>%
nest() %>%
mutate(
datasvy = map(.x = data,
.f = ~svydesign(id =~ V001, strata =~ V022, weights=~V005, data=.x))
)
options(survey.lonely.psu="remove")
i_n <- df %>%
mutate(
agemother_m = map(.x = datasvy,
.f = ~svymean(~as.factor(AGE_MOTHER), design = .x, na.rm = T, vartype = c("se","ci")) %>%
as.vector() %>%
as.data.frame() %>%
mutate("prop" = as.numeric(.))%>%
select(-.)),
agemother_ci = map(.x = datasvy,
.f = ~svymean(~as.factor(AGE_MOTHER), design = .x, na.rm = T, vartype = c("se","ci")) %>%
confint() %>%
as.data.frame() %>%
rownames_to_column(var = "var")),
agemother = map2(.x = agemother_m,
.y = agemother_ci,
.f = ~bind_cols(.x,.y)))
i_n
i_n$agemother_ci
ic <- df %>%
mutate(
agemother_ci = map(.x = datasvy,
.f = ~svymean(~as.factor(AGE_MOTHER), design = .x, na.rm = T, vartype = c("se","ci")) %>%
confint() %>%
as.data.frame() %>%
rownames_to_column(var = "var")))
ic
ic$data
ic$datasvy
ic$agemother_ci
ic %>% unnest()
ic$agemother_ci
ic %>% unnest(cols = ic$agemother_ci)
ic %>% unnest(agemother_ci)
ic[-c(data,datasvy)]
ic
ic[-c('data','datasvy')]
ic[-('data','datasvy')]
ic[-(data,datasvy)]
ic %>% select(year,agemother_ci) %>% unnest(agemother_ci)
length(variables)
variables[1]
i=1
for (i in 1 : length(variables)) {
ic <- df %>%
mutate(
ci = map(.x = datasvy,
.f = ~svymean(~as.factor(i[1]), design = .x, na.rm = T, vartype = c("se","ci")) %>%
confint() %>%
as.data.frame() %>%
rownames_to_column(var = "var")))
print(ic %>% select(year,ci) %>% unnest(ci))
i+1
}
for (i in 1 : length(variables)) {
ic <- df %>%
mutate(
ci = map(.x = datasvy,
.f = ~svymean(~as.factor(variables[i]), design = .x, na.rm = T, vartype = c("se","ci")) %>%
confint() %>%
as.data.frame() %>%
rownames_to_column(var = "var")))
print(ic %>% select(year,ci) %>% unnest(ci))
i+1
}
for (i in 1 : length(variables)) {
i=i+1
ic <- df %>%
mutate(
ci = map(.x = datasvy,
.f = ~svymean(~as.factor(variables[i]), design = .x, na.rm = T, vartype = c("se","ci")) %>%
confint() %>%
as.data.frame() %>%
rownames_to_column(var = "var")))
print(ic %>% select(year,ci) %>% unnest(ci))
}
i=1
for (i in 1 : length(variables)) {
i=i+1
ic <- df %>%
mutate(
ci = map(.x = datasvy,
.f = ~svymean(~as.factor(variables[i]), design = .x, na.rm = T, vartype = c("se","ci")) %>%
confint() %>%
as.data.frame() %>%
rownames_to_column(var = "var")))
print(ic %>% select(year,ci) %>% unnest(ci))
}
for (i in 1 : length(variables)) {
ic <- df %>%
mutate(
ci = map(.x = datasvy,
.f = ~svymean(~as.factor(variables[i]), design = .x, na.rm = T, vartype = c("se","ci")) %>%
confint() %>%
as.data.frame() %>%
rownames_to_column(var = "var")))
print(ic %>% select(year,ci) %>% unnest(ci))
i=i+1
}
ic <- df %>%
mutate(
ci = map(.x = datasvy,
.f = ~svymean(~as.factor(variables[1]), design = .x, na.rm = T, vartype = c("se","ci")) %>%
confint() %>%
as.data.frame() %>%
rownames_to_column(var = "var")))
variables[1]
ic <- df %>%
mutate(
ci = map(.x = datasvy,
.f = ~svymean(~as.factor(variables[2]), design = .x, na.rm = T, vartype = c("se","ci")) %>%
confint() %>%
as.data.frame() %>%
rownames_to_column(var = "var")))
variables[2]
ic <- df %>%
mutate(
ci = map(.x = datasvy,
.f = ~svymean(~as.factor(variables[2]), design = .x, na.rm = T, vartype = c("se","ci")) %>%
confint() %>%
as.data.frame() %>%
rownames_to_column(var = "var")))
ic <- df %>%
mutate(
i_c = map(.x = datasvy,
.f = ~svymean(~as.factor(variables[2]), design = .x, na.rm = T, vartype = c("se","ci")) %>%
confint() %>%
as.data.frame() %>%
rownames_to_column(var = "var")))
df %>%
mutate(
agemother_ci = map(.x = datasvy,
.f = ~svymean(~as.factor(AGE_MOTHER), design = .x, na.rm = T, vartype = c("se","ci")) %>%
confint() %>%
as.data.frame() %>%
rownames_to_column(var = "var")))
ic <- df %>%
mutate(
i_c = map(.x = datasvy,
.f = ~svymean(~as.factor(variables[2]), design = .x, na.rm = T, vartype = c("se","ci")) %>%
confint() %>%
as.data.frame() %>%
rownames_to_column(var = "var")))
variables[2]
variables[[2]]
variables[2]
as.name(variables[2])
ic <- df %>%
mutate(
i_c = map(.x = datasvy,
.f = ~svymean(~as.factor(as.name(variables[2])), design = .x, na.rm = T, vartype = c("se","ci")) %>%
confint() %>%
as.data.frame() %>%
rownames_to_column(var = "var")))
as.name(variables[2])
ic <- df %>%
mutate(
agemother_ci = map(.x = datasvy,
.f = ~svymean(~as.factor(AGE_MOTHER), design = .x, na.rm = T, vartype = c("se","ci")) %>%
confint() %>%
as.data.frame() %>%
rownames_to_column(var = "var")))
ic <- df %>%
mutate(
i_c = map(.x = datasvy,
.f = ~svymean(~as.factor(as.name(variables[2])), design = .x, na.rm = T, vartype = c("se","ci")) %>%
confint() %>%
as.data.frame() %>%
rownames_to_column(var = "var")))
ic <- df %>%
mutate(
agemother_ci = map(.x = datasvy,
.f = ~svymean(~as.factor(as.name(variables[2])), design = .x, na.rm = T, vartype = c("se","ci")) %>%
confint() %>%
as.data.frame() %>%
rownames_to_column(var = "var")))
ic <- df %>%
mutate(
agemother_ci = map(.x = datasvy,
.f = ~svymean(~as.factor(as.name(variables[2])), design = .x, na.rm = T, vartype = c("se","ci")) %>%
confint() %>%
as.data.frame() %>%
rownames_to_column(var = "var")))
ic <- df %>%
mutate(
agemother_ci = map(.x = datasvy,
.f = ~svymean(~as.factor(as.name(variables[2])), design = .x, na.rm = T, vartype = c("se","ci")) %>%
confint() %>%
as.data.frame() %>%
rownames_to_column(var = "var")))
ic <- df %>%
mutate(
agemother_ci = map(.x = datasvy,
.f = ~svymean(~as.factor(AGE_MOTHER), design = .x, na.rm = T, vartype = c("se","ci")) %>%
confint() %>%
as.data.frame() %>%
rownames_to_column(var = "var")))
ic
ic <- df %>%
mutate(
i_c = map(.x = datasvy,
.f = ~svymean(~as.factor(as.name(variables[2])), design = .x, na.rm = T, vartype = c("se","ci")) %>%
confint() %>%
as.data.frame() %>%
rownames_to_column(var = "var")))
as.factor(AGE_MOTHER)
as.factor(as.name(variables[2]))
as.factor(AGE_MOTHER)
as.factor(as.name(variables[2]))
as.name(variables[2])
variables <-  c("year","AGE_MOTHER","EDUCATION_LEVEL","CURRENT_MARITAL_STATUS","KNOW_STD","KNOW_STD_SYMPTOM","V001","V005",
"V022","IDX94","B2","filtro" )
i=1
for (i in 2 : length(variables)-5) {
ic <- df %>%
mutate(
i_c = map(.x = datasvy,
.f = ~svymean(~as.factor(as.name(variables[2])), design = .x, na.rm = T, vartype = c("se","ci")) %>%
confint() %>%
as.data.frame() %>%
rownames_to_column(var = "var")))
print(ic %>% select(year,i_c) %>% unnest(i_c))
i=i+1
}
variables <-  c("year","AGE_MOTHER","EDUCATION_LEVEL","CURRENT_MARITAL_STATUS","KNOW_STD","KNOW_STD_SYMPTOM","V001","V005",
"V022","IDX94","B2","filtro" )
i=1
for (i in 2 : length(variables)-5) {
ic <- df %>%
mutate(
i_c = map(.x = datasvy,
.f = ~svymean(~as.factor(as.name(variables[2])), design = .x, na.rm = T, vartype = c("se","ci")) %>%
confint() %>%
as.data.frame() %>%
rownames_to_column(var = "var")))
#print(ic %>% select(year,i_c) %>% unnest(i_c))
#i=i+1
i_c
}
as.factor(df[variables[2]])
for (i in 2 : length(variables)-5) {
df<-
datav %>%
group_by(year) %>%
nest() %>%
mutate(
datasvy = map(.x = data,
.f = ~svydesign(id =~ V001, strata =~ V022, weights=~V005, data=.x))
)
options(survey.lonely.psu="remove")
ic <- df %>%
mutate(
i_c = map(.x = datasvy,
.f = ~svymean(~as.factor(as.name(variables[2])), design = .x, na.rm = T, vartype = c("se","ci")) %>%
confint() %>%
as.data.frame() %>%
rownames_to_column(var = "var")))
#print(ic %>% select(year,i_c) %>% unnest(i_c))
#i=i+1
i_c
}
df<-
datav %>%
group_by(year) %>%
nest() %>%
mutate(
datasvy = map(.x = data,
.f = ~svydesign(id =~ V001, strata =~ V022, weights=~V005, data=.x))
)
options(survey.lonely.psu="remove")
ic <- df %>%
mutate(
i_c = map(.x = datasvy,
.f = ~svymean(~as.factor(as.name(variables[2])), design = .x, na.rm = T, vartype = c("se","ci")) %>%
confint() %>%
as.data.frame() %>%
rownames_to_column(var = "var")))
df<-
datav %>%
group_by(year) %>%
nest() %>%
mutate(
datasvy = map(.x = data,
.f = ~svydesign(id =~ V001, strata =~ V022, weights=~V005, data=.x))
)
options(survey.lonely.psu="remove")
ic <- df %>%
mutate(
i_c = map(.x = datasvy,
.f = ~svymean(~as.factor(as.name(variables[2])), design = .x, na.rm = T, vartype = c("se","ci")) %>%
confint() %>%
as.data.frame() %>%
rownames_to_column(var = "var")))
as.factor(as.name(variables[2]))
as.factor(unique(as.name(variables[2])))
as.factor(as.name(unique(variables[2])))
variables[2]
as.name(variables[2])
as.factor(as.name(variables[2]))
as.factor(as.name(datav$variables[2]))
datav <- data_read[variables]
datav$variables[2]
datav[variables[2]]
datav[variables[2]]
as.name(datav[variables[2]])
name(datav[variables[2]])
names(datav[variables[2]])
as.factor(names(datav[variables[2]]))
df<-
datav %>%
group_by(year) %>%
nest() %>%
mutate(
datasvy = map(.x = data,
.f = ~svydesign(id =~ V001, strata =~ V022, weights=~V005, data=.x))
)
options(survey.lonely.psu="remove")
ic <- df %>%
mutate(
i_c = map(.x = datasvy,
.f = ~svymean(~as.factor(names(datav[variables[2]])), design = .x, na.rm = T, vartype = c("se","ci")) %>%
confint() %>%
as.data.frame() %>%
rownames_to_column(var = "var")))
df
df<-
datav %>%
group_by(year) %>%
nest() %>%
mutate(
datasvy = map(.x = data,
.f = ~svydesign(id =~ V001, strata =~ V022, weights=~V005, data=.x))
)
options(survey.lonely.psu="remove")
ic <- df %>%
mutate(
i_c = map(.x = datasvy,
.f = ~svymean(~as.factor(as.name(variables[2])), design = .x, na.rm = T, vartype = c("se","ci")) %>%
confint() %>%
as.data.frame() %>%
rownames_to_column(var = "var")))
df<-
datav %>%
group_by(year) %>%
nest() %>%
mutate(
datasvy = map(.x = data,
.f = ~svydesign(id =~ V001, strata =~ V022, weights=~V005, data=.x))
)
options(survey.lonely.psu="remove")
variables <-  c("year","AGE_MOTHER","EDUCATION_LEVEL","CURRENT_MARITAL_STATUS","KNOW_STD","KNOW_STD_SYMPTOM","V001","V005",
"V022","IDX94","B2","filtro" )
ic <- df %>%
mutate(
i_c = map(.x = datasvy,
.f = ~svymean(~as.factor(as.name(variables[2])), design = .x, na.rm = T, vartype = c("se","ci")) %>%
confint() %>%
as.data.frame() %>%
rownames_to_column(var = "var")))
rlang::last_trace()
for (i in 2 : length(variables)-5) {
df<-
datav %>%
group_by(year) %>%
nest() %>%
mutate(
datasvy = map(.x = data,
.f = ~svydesign(id =~ V001, strata =~ V022, weights=~V005, data=.x))
)
options(survey.lonely.psu="remove")
variables <-  c("year","AGE_MOTHER","EDUCATION_LEVEL","CURRENT_MARITAL_STATUS","KNOW_STD","KNOW_STD_SYMPTOM","V001","V005",
"V022","IDX94","B2","filtro" )
ic <- df %>%
mutate(
i_c = map(.x = datasvy,
.f = ~svymean(~as.factor(as.name(variables[2])), design = .x, na.rm = T, vartype = c("se","ci")) %>%
confint() %>%
as.data.frame() %>%
rownames_to_column(var = "var")))
#print(ic %>% select(year,i_c) %>% unnest(i_c))
#i=i+1
print(ic)
}
for (i in 2 : length(variables)-5) {
df<-
datav %>%
group_by(year) %>%
nest() %>%
mutate(
datasvy = map(.x = data,
.f = ~svydesign(id =~ V001, strata =~ V022, weights=~V005, data=.x))
)
options(survey.lonely.psu="remove")
variables <-  c("year","AGE_MOTHER","EDUCATION_LEVEL","CURRENT_MARITAL_STATUS","KNOW_STD","KNOW_STD_SYMPTOM","V001","V005",
"V022","IDX94","B2","filtro" )
ic <- df %>%
mutate(
i_c = map(.x = datasvy,
.f = ~svymean(~as.factor(as.name(variables[2])), design = .x, na.rm = T, vartype = c("se","ci")) %>%
confint() %>%
as.data.frame() %>%
rownames_to_column(var = "var")))
#print(ic %>% select(year,i_c) %>% unnest(i_c))
#i=i+1
ic
--print(ic)
}
for (i in 2 : length(variables)-5) {
df<-
datav %>%
group_by(year) %>%
nest() %>%
mutate(
datasvy = map(.x = data,
.f = ~svydesign(id =~ V001, strata =~ V022, weights=~V005, data=.x))
)
options(survey.lonely.psu="remove")
variables <-  c("year","AGE_MOTHER","EDUCATION_LEVEL","CURRENT_MARITAL_STATUS","KNOW_STD","KNOW_STD_SYMPTOM","V001","V005",
"V022","IDX94","B2","filtro" )
ic <- df %>%
mutate(
i_c = map(.x = datasvy,
.f = ~svymean(~as.factor(as.name(variables[2])), design = .x, na.rm = T, vartype = c("se","ci")) %>%
confint() %>%
as.data.frame() %>%
rownames_to_column(var = "var")))
#print(ic %>% select(year,i_c) %>% unnest(i_c))
ic
}
df<-
datav %>%
group_by(year) %>%
nest() %>%
mutate(
datasvy = map(.x = data,
.f = ~svydesign(id =~ V001, strata =~ V022, weights=~V005, data=.x))
)
options(survey.lonely.psu="remove")
df
ic <- df %>%
mutate(
agemother_ci = map(.x = datasvy,
.f = ~svymean(~as.factor(AGE_MOTHER), design = .x, na.rm = T, vartype = c("se","ci")) %>%
confint() %>%
as.data.frame() %>%
rownames_to_column(var = "var")))
ic %>% select(year,agemother_ci) %>% unnest(agemother_ci)
as.factor(AGE_MOTHER)
