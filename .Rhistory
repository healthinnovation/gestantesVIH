ci = map(.x = datasvy,
.f = ~svymean(~as.factor(variables[2]), design = .x, na.rm = T, vartype = c("se","ci")) %>%
confint() %>%
as.data.frame() %>%
rownames_to_column(var = "var")))
ic <- df %>%
mutate(
i_c = map(.x = datasvy,
.f = ~svymean(~as.factor(variables[2]), design = .x, na.rm = T, vartype = c("se","ci")) %>%
confint() %>%
as.data.frame() %>%
rownames_to_column(var = "var")))
df %>%
mutate(
agemother_ci = map(.x = datasvy,
.f = ~svymean(~as.factor(AGE_MOTHER), design = .x, na.rm = T, vartype = c("se","ci")) %>%
confint() %>%
as.data.frame() %>%
rownames_to_column(var = "var")))
ic <- df %>%
mutate(
i_c = map(.x = datasvy,
.f = ~svymean(~as.factor(variables[2]), design = .x, na.rm = T, vartype = c("se","ci")) %>%
confint() %>%
as.data.frame() %>%
rownames_to_column(var = "var")))
variables[2]
variables[[2]]
variables[2]
as.name(variables[2])
ic <- df %>%
mutate(
i_c = map(.x = datasvy,
.f = ~svymean(~as.factor(as.name(variables[2])), design = .x, na.rm = T, vartype = c("se","ci")) %>%
confint() %>%
as.data.frame() %>%
rownames_to_column(var = "var")))
as.name(variables[2])
ic <- df %>%
mutate(
agemother_ci = map(.x = datasvy,
.f = ~svymean(~as.factor(AGE_MOTHER), design = .x, na.rm = T, vartype = c("se","ci")) %>%
confint() %>%
as.data.frame() %>%
rownames_to_column(var = "var")))
ic <- df %>%
mutate(
i_c = map(.x = datasvy,
.f = ~svymean(~as.factor(as.name(variables[2])), design = .x, na.rm = T, vartype = c("se","ci")) %>%
confint() %>%
as.data.frame() %>%
rownames_to_column(var = "var")))
ic <- df %>%
mutate(
agemother_ci = map(.x = datasvy,
.f = ~svymean(~as.factor(as.name(variables[2])), design = .x, na.rm = T, vartype = c("se","ci")) %>%
confint() %>%
as.data.frame() %>%
rownames_to_column(var = "var")))
ic <- df %>%
mutate(
agemother_ci = map(.x = datasvy,
.f = ~svymean(~as.factor(as.name(variables[2])), design = .x, na.rm = T, vartype = c("se","ci")) %>%
confint() %>%
as.data.frame() %>%
rownames_to_column(var = "var")))
ic <- df %>%
mutate(
agemother_ci = map(.x = datasvy,
.f = ~svymean(~as.factor(as.name(variables[2])), design = .x, na.rm = T, vartype = c("se","ci")) %>%
confint() %>%
as.data.frame() %>%
rownames_to_column(var = "var")))
ic <- df %>%
mutate(
agemother_ci = map(.x = datasvy,
.f = ~svymean(~as.factor(AGE_MOTHER), design = .x, na.rm = T, vartype = c("se","ci")) %>%
confint() %>%
as.data.frame() %>%
rownames_to_column(var = "var")))
ic
ic <- df %>%
mutate(
i_c = map(.x = datasvy,
.f = ~svymean(~as.factor(as.name(variables[2])), design = .x, na.rm = T, vartype = c("se","ci")) %>%
confint() %>%
as.data.frame() %>%
rownames_to_column(var = "var")))
as.factor(AGE_MOTHER)
as.factor(as.name(variables[2]))
as.factor(AGE_MOTHER)
as.factor(as.name(variables[2]))
as.name(variables[2])
variables <-  c("year","AGE_MOTHER","EDUCATION_LEVEL","CURRENT_MARITAL_STATUS","KNOW_STD","KNOW_STD_SYMPTOM","V001","V005",
"V022","IDX94","B2","filtro" )
i=1
for (i in 2 : length(variables)-5) {
ic <- df %>%
mutate(
i_c = map(.x = datasvy,
.f = ~svymean(~as.factor(as.name(variables[2])), design = .x, na.rm = T, vartype = c("se","ci")) %>%
confint() %>%
as.data.frame() %>%
rownames_to_column(var = "var")))
print(ic %>% select(year,i_c) %>% unnest(i_c))
i=i+1
}
variables <-  c("year","AGE_MOTHER","EDUCATION_LEVEL","CURRENT_MARITAL_STATUS","KNOW_STD","KNOW_STD_SYMPTOM","V001","V005",
"V022","IDX94","B2","filtro" )
i=1
for (i in 2 : length(variables)-5) {
ic <- df %>%
mutate(
i_c = map(.x = datasvy,
.f = ~svymean(~as.factor(as.name(variables[2])), design = .x, na.rm = T, vartype = c("se","ci")) %>%
confint() %>%
as.data.frame() %>%
rownames_to_column(var = "var")))
#print(ic %>% select(year,i_c) %>% unnest(i_c))
#i=i+1
i_c
}
as.factor(df[variables[2]])
for (i in 2 : length(variables)-5) {
df<-
datav %>%
group_by(year) %>%
nest() %>%
mutate(
datasvy = map(.x = data,
.f = ~svydesign(id =~ V001, strata =~ V022, weights=~V005, data=.x))
)
options(survey.lonely.psu="remove")
ic <- df %>%
mutate(
i_c = map(.x = datasvy,
.f = ~svymean(~as.factor(as.name(variables[2])), design = .x, na.rm = T, vartype = c("se","ci")) %>%
confint() %>%
as.data.frame() %>%
rownames_to_column(var = "var")))
#print(ic %>% select(year,i_c) %>% unnest(i_c))
#i=i+1
i_c
}
df<-
datav %>%
group_by(year) %>%
nest() %>%
mutate(
datasvy = map(.x = data,
.f = ~svydesign(id =~ V001, strata =~ V022, weights=~V005, data=.x))
)
options(survey.lonely.psu="remove")
ic <- df %>%
mutate(
i_c = map(.x = datasvy,
.f = ~svymean(~as.factor(as.name(variables[2])), design = .x, na.rm = T, vartype = c("se","ci")) %>%
confint() %>%
as.data.frame() %>%
rownames_to_column(var = "var")))
df<-
datav %>%
group_by(year) %>%
nest() %>%
mutate(
datasvy = map(.x = data,
.f = ~svydesign(id =~ V001, strata =~ V022, weights=~V005, data=.x))
)
options(survey.lonely.psu="remove")
ic <- df %>%
mutate(
i_c = map(.x = datasvy,
.f = ~svymean(~as.factor(as.name(variables[2])), design = .x, na.rm = T, vartype = c("se","ci")) %>%
confint() %>%
as.data.frame() %>%
rownames_to_column(var = "var")))
as.factor(as.name(variables[2]))
as.factor(unique(as.name(variables[2])))
as.factor(as.name(unique(variables[2])))
variables[2]
as.name(variables[2])
as.factor(as.name(variables[2]))
as.factor(as.name(datav$variables[2]))
datav <- data_read[variables]
datav$variables[2]
datav[variables[2]]
datav[variables[2]]
as.name(datav[variables[2]])
name(datav[variables[2]])
names(datav[variables[2]])
as.factor(names(datav[variables[2]]))
df<-
datav %>%
group_by(year) %>%
nest() %>%
mutate(
datasvy = map(.x = data,
.f = ~svydesign(id =~ V001, strata =~ V022, weights=~V005, data=.x))
)
options(survey.lonely.psu="remove")
ic <- df %>%
mutate(
i_c = map(.x = datasvy,
.f = ~svymean(~as.factor(names(datav[variables[2]])), design = .x, na.rm = T, vartype = c("se","ci")) %>%
confint() %>%
as.data.frame() %>%
rownames_to_column(var = "var")))
df
df<-
datav %>%
group_by(year) %>%
nest() %>%
mutate(
datasvy = map(.x = data,
.f = ~svydesign(id =~ V001, strata =~ V022, weights=~V005, data=.x))
)
options(survey.lonely.psu="remove")
ic <- df %>%
mutate(
i_c = map(.x = datasvy,
.f = ~svymean(~as.factor(as.name(variables[2])), design = .x, na.rm = T, vartype = c("se","ci")) %>%
confint() %>%
as.data.frame() %>%
rownames_to_column(var = "var")))
df<-
datav %>%
group_by(year) %>%
nest() %>%
mutate(
datasvy = map(.x = data,
.f = ~svydesign(id =~ V001, strata =~ V022, weights=~V005, data=.x))
)
options(survey.lonely.psu="remove")
variables <-  c("year","AGE_MOTHER","EDUCATION_LEVEL","CURRENT_MARITAL_STATUS","KNOW_STD","KNOW_STD_SYMPTOM","V001","V005",
"V022","IDX94","B2","filtro" )
ic <- df %>%
mutate(
i_c = map(.x = datasvy,
.f = ~svymean(~as.factor(as.name(variables[2])), design = .x, na.rm = T, vartype = c("se","ci")) %>%
confint() %>%
as.data.frame() %>%
rownames_to_column(var = "var")))
rlang::last_trace()
for (i in 2 : length(variables)-5) {
df<-
datav %>%
group_by(year) %>%
nest() %>%
mutate(
datasvy = map(.x = data,
.f = ~svydesign(id =~ V001, strata =~ V022, weights=~V005, data=.x))
)
options(survey.lonely.psu="remove")
variables <-  c("year","AGE_MOTHER","EDUCATION_LEVEL","CURRENT_MARITAL_STATUS","KNOW_STD","KNOW_STD_SYMPTOM","V001","V005",
"V022","IDX94","B2","filtro" )
ic <- df %>%
mutate(
i_c = map(.x = datasvy,
.f = ~svymean(~as.factor(as.name(variables[2])), design = .x, na.rm = T, vartype = c("se","ci")) %>%
confint() %>%
as.data.frame() %>%
rownames_to_column(var = "var")))
#print(ic %>% select(year,i_c) %>% unnest(i_c))
#i=i+1
print(ic)
}
for (i in 2 : length(variables)-5) {
df<-
datav %>%
group_by(year) %>%
nest() %>%
mutate(
datasvy = map(.x = data,
.f = ~svydesign(id =~ V001, strata =~ V022, weights=~V005, data=.x))
)
options(survey.lonely.psu="remove")
variables <-  c("year","AGE_MOTHER","EDUCATION_LEVEL","CURRENT_MARITAL_STATUS","KNOW_STD","KNOW_STD_SYMPTOM","V001","V005",
"V022","IDX94","B2","filtro" )
ic <- df %>%
mutate(
i_c = map(.x = datasvy,
.f = ~svymean(~as.factor(as.name(variables[2])), design = .x, na.rm = T, vartype = c("se","ci")) %>%
confint() %>%
as.data.frame() %>%
rownames_to_column(var = "var")))
#print(ic %>% select(year,i_c) %>% unnest(i_c))
#i=i+1
ic
--print(ic)
}
for (i in 2 : length(variables)-5) {
df<-
datav %>%
group_by(year) %>%
nest() %>%
mutate(
datasvy = map(.x = data,
.f = ~svydesign(id =~ V001, strata =~ V022, weights=~V005, data=.x))
)
options(survey.lonely.psu="remove")
variables <-  c("year","AGE_MOTHER","EDUCATION_LEVEL","CURRENT_MARITAL_STATUS","KNOW_STD","KNOW_STD_SYMPTOM","V001","V005",
"V022","IDX94","B2","filtro" )
ic <- df %>%
mutate(
i_c = map(.x = datasvy,
.f = ~svymean(~as.factor(as.name(variables[2])), design = .x, na.rm = T, vartype = c("se","ci")) %>%
confint() %>%
as.data.frame() %>%
rownames_to_column(var = "var")))
#print(ic %>% select(year,i_c) %>% unnest(i_c))
ic
}
df<-
datav %>%
group_by(year) %>%
nest() %>%
mutate(
datasvy = map(.x = data,
.f = ~svydesign(id =~ V001, strata =~ V022, weights=~V005, data=.x))
)
options(survey.lonely.psu="remove")
df
ic <- df %>%
mutate(
agemother_ci = map(.x = datasvy,
.f = ~svymean(~as.factor(AGE_MOTHER), design = .x, na.rm = T, vartype = c("se","ci")) %>%
confint() %>%
as.data.frame() %>%
rownames_to_column(var = "var")))
ic %>% select(year,agemother_ci) %>% unnest(agemother_ci)
as.factor(AGE_MOTHER)
setwd("~/GitHub/gestantesVIH")
library(tidyverse)
library(survey)
#library(dplyr)
#library(gtsummary)
data_read<-read.csv("./datatest.csv")
attach(data_read)
names(data_read)
variables <-  c("year","AGE_MOTHER","EDUCATION_LEVEL","CURRENT_MARITAL_STATUS","KNOW_STD","KNOW_STD_SYMPTOM","V001","V005",
"V022","IDX94","B2","filtro" )
datav <- data_read[variables]
nrow(datav)
variables <-  c("year","AGE_MOTHER","EDUCATION_LEVEL","CURRENT_MARITAL_STATUS","KNOW_STD","KNOW_STD_SYMPTOM","V001","V005",
"V022","IDX94","B2","filtro" )
for (i in 2 : length(variables)-5) {
df<-
datav %>%
group_by(year) %>%
nest() %>%
mutate(
datasvy = map(.x = data,
.f = ~svydesign(id =~ V001, strata =~ V022, weights=~V005, data=.x))
)
options(survey.lonely.psu="remove")
variables <-  c("year","AGE_MOTHER","EDUCATION_LEVEL","CURRENT_MARITAL_STATUS","KNOW_STD","KNOW_STD_SYMPTOM","V001","V005",
"V022","IDX94","B2","filtro" )
ic <- df %>%
mutate(
i_c = map(.x = datasvy,
.f = ~svymean(~as.factor(as.name(variables[2])), design = .x, na.rm = T, vartype = c("se","ci")) %>%
confint() %>%
as.data.frame() %>%
rownames_to_column(var = "var")))
#print(ic %>% select(year,i_c) %>% unnest(i_c))
ic
}
df<-
datav %>%
group_by(year) %>%
nest() %>%
mutate(
datasvy = map(.x = data,
.f = ~svydesign(id =~ V001, strata =~ V022, weights=~V005, data=.x))
)
options(survey.lonely.psu="remove")
variables <-  c("year","AGE_MOTHER","EDUCATION_LEVEL","CURRENT_MARITAL_STATUS","KNOW_STD","KNOW_STD_SYMPTOM","V001","V005",
"V022","IDX94","B2","filtro" )
ic <- df %>%
mutate(
i_c = map(.x = datasvy,
.f = ~svymean(~as.factor(as.name(variables[2])), design = .x, na.rm = T, vartype = c("se","ci")) %>%
confint() %>%
as.data.frame() %>%
rownames_to_column(var = "var")))
as.name(variables[2])
variables[2]
as.factor(AGE_MOTHER)
ic %>% select(year,agemother_ci) %>% unnest(agemother_ci)
df<-
datav %>%
group_by(year) %>%
nest() %>%
mutate(
datasvy = map(.x = data,
.f = ~svydesign(id =~ V001, strata =~ V022, weights=~V005, data=.x))
)
options(survey.lonely.psu="remove")
df
ic <- df %>%
mutate(
agemother_ci = map(.x = datasvy,
.f = ~svymean(~as.factor(AGE_MOTHER), design = .x, na.rm = T, vartype = c("se","ci")) %>%
confint() %>%
as.data.frame() %>%
rownames_to_column(var = "var")))
ic %>% select(year,agemother_ci) %>% unnest(agemother_ci)
ic
ic %>% select(year,agemother_ci) %>% unnest(agemother_ci)
df<-
datav %>%
group_by(year) %>%
nest() %>%
mutate(
datasvy = map(.x = data,
.f = ~svydesign(id =~ V001, strata =~ V022, weights=~V005, data=.x))
)
options(survey.lonely.psu="remove")
df
ic <- df %>%
mutate(
agemother_ci = map(.x = datasvy,
.f = ~svymean(~as.factor(AGE_MOTHER), design = .x, na.rm = T, vartype = c("se","ci")) %>%
confint() %>%
as.data.frame() %>%
rownames_to_column(var = "var")),
agemother_m = map(.x = datasvy,
.f = ~svymean(~as.factor(AGE_MOTHER), design = .x, na.rm = T, vartype = c("se","ci")) %>%
as.vector() %>%
as.data.frame() %>%
mutate("prop" = as.numeric(.))%>%
select(-.)))
ic
ic %>% select(year,agemother_ci,agemother_m) %>% unnest(agemother_ci,agemother_m)
ic %>% select(year,agemother_ci,agemother_m) %>% unnest(c(agemother_ci,agemother_m))
table(datav$AGE_MOTHER)
table(EDUCATION_LEVEL)
table(CURRENT_MARITAL_STATUS)
table(KNOW_STD)
table(KNOW_STD_SYMPTOM)
ic %>% select(year,agemother_ci) %>% unnest(agemother_ci)
ic
ic %>% select(year,agemother_ci) %>% unnest(agemother_ci)
df<-
datav %>%
group_by(year) %>%
nest() %>%
mutate(
datasvy = map(.x = data,
.f = ~svydesign(id =~ V001, strata =~ V022, weights=~V005, data=.x))
)
options(survey.lonely.psu="remove")
variables <-  c("year","AGE_MOTHER","EDUCATION_LEVEL","CURRENT_MARITAL_STATUS","KNOW_STD","KNOW_STD_SYMPTOM","V001","V005",
"V022","IDX94","B2","filtro" )
ic <- df %>%
mutate(
i_c = map(.x = datasvy,
.f = ~svymean(~as.factor(as.name(variables[2])), design = .x, na.rm = T, vartype = c("se","ci")) %>%
confint() %>%
as.data.frame() %>%
rownames_to_column(var = "var")))
names(data_read)
setwd("~/GitHub/gestantesVIH")
gestantes <- readr::read_csv("./datatest.csv")
library(dplyr)
library(survey)
library(srvyr)
install.packages("srvyr")
library(srvyr)
library(tidyr)
names(gestantes)
variables <- c(
"AGE_MOTHER"                            ,"WEALTH_INDEX"
"RELATIONSHIP_HOUSEHOLD_HEAD"           ,"TYPE_PLACE_RESIDENCE"
variables <- c(
"AGE_MOTHER"                            ,"WEALTH_INDEX"
,"RELATIONSHIP_HOUSEHOLD_HEAD"           ,"TYPE_PLACE_RESIDENCE"
,"HOUSEHOLD_MEMBERS"                     ,"ETHNICITY"
,"DEPARTMENT"                            ,"EDUCATION_LEVEL"
,"NATURAL_REGION"                        ,"KNOW_STD"
,"KNOW_STD_SYMPTOM"                      ,"CHECKUP_RULE_OUT_SYPHILIS"
,"CHECKUP_RULE_OUT_HIV"                  ,"PRENATAL_ATTENTION_PROFESSIONAL_LEVEL"
,"INTENDED_PREGNANCY"                    ,"FIRST_PRENATAL_VISIT"
,"NUMBER_PRENATAL_VISITS"                ,"PRENATAL_ATTENTION_PLACE"
,"HAVE_STD_SYMPTOM"                      ,"KNOW_MTCT_HIV_DURING_PREGNANCY"
,"KNOW_MTCT_HIV_DURING_CHILDBIRTH"       ,"KNOW_MTCT_HIV_DURING_BREASTFEEDING"
,"KNOW_MTCT_HIV"                         ,"HEALTH_INSURANCE"
,"CURRENT_MARITAL_STATUS"
)
options(survey.lonely.psu = "remove")
ic <- expand_grid(variables, gestantes) |>
nest(data = -c(year, variables)) |>
mutate(
design = purrr::map(
data,
~ as_survey_design(.x, ids = V001, strata = V022, weights = V005)
),
ic = purrr::map2(
design, variables,
~ group_by(.x, across(all_of(.y))) |>
summarise(prop = survey_prop(vartype = "ci", proportion = TRUE))
)
)
ic_unnest <- ic |>
select(-c(data, design)) |>
unnest(ic)
view(ic_unnest)
write.csv(ic_unnest,file = "intervalos.csv",sep = ",")
write.csv(ic_unnest,file = "intervalos.csv")
write.csv(ic_unnest,file = "intervalos.csv",append = FALSE)
write.csv(ic_unnest,append = FALSE,file = "intervalos.csv")
write.csv(ic_unnest,file = "intervalos.csv")
